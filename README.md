# Project Starter for publishing a new Node.js/Typescript project at NPM

This is a project starter for publishing a new Node.js/Typescript project at NPM. It's based on the [npm-package-starter](https://github.com/IlyaSemenov/npm-package-starter). And I did some enhancements for my own needs.

## Pre-requisites
Before you start, make sure you have the following tools installed:

- [Node.js](https://nodejs.org/)
- [pnpm](https://pnpm.io/)
- [GitHub CLI](https://cli.github.com/)

And, you have to find out the following key things:
- PROJECT: project name
- NPM_TOKEN: npm access token, write access will be used to publish the package to npm registry.

Here comes the method to get these information ready, if you already have them, then you can skip this step:
- **PROJECT**: Pick a name for the new project. You can use the following command to check with [npm](https://www.npmjs.com/) repository to get an available name:
```
npm search <project-name>
```

This command will search the registry for packages matching the search terms, and performs a linear, incremental, lexically-ordered search through package metadata for all files in the registry. Based on the search results, you can choose a name that is not already taken.

- **NPM_TOKEN**: You can refer to [this web page](https://docs.npmjs.com/creating-and-viewing-access-tokens) to create a new token. Or just use one of the following commands to get access token.
```bash
# Before you can access npmjs.com via command line, you need to login first
npm login

# for a read and publish token
npm token create

 # for a read-only token
npm token create --read-only

# for a CIDR-restricted read and publish token. For example, npm token create --cidr=192.0.2.0/24
npm token create --cidr=[list]

# for a CIDR-restricted read-only token
npm token create --read-only --cidr=[list]
```
>TODO: above commands need to be confirmed as I do not need them so far.


Once you get above information ready, you can set them all into shell variables:
```bash
PROJECT=<project-name>
NPM_TOKEN=<npm-access-token>
```

## Initialize project
```bash
# clone current repo
git clone https://github.com/IlyaSemenov/npm-package-starter.git $PROJECT
cd $PROJECT

# get rid of .git information
rm -rf .git

# Use find + xargs to search and replace `mylib` with the new project name $PROJECT for the whole project.
find . -type f \( -name "*.md" -o -name "*.ts" -o -name "*.js" -o -name "*.json" \) -print0 | xargs -0 perl -i -pe "s#mylib#$PROJECT#g"
# TODO: 1, If your $PROJECT contains spaces or special characters, you need to update some files manually due to the aggressive nature of the find command, for example README.md.
# TODO: 2, You also need to update the `package.json` 's `repository.url` as `https://github.com/$(git config user.name)/$PROJECT.git`

# overwrite the README.md with new
mv README.lib.md README.md
git rm README.lib.md

# Before you can access github.com or npmjs.com via command line, you need to login first:
gh auth login

# create remote repository on github.com
gh repo create $PROJECT --public

# use gh to login to github.com, and set secrets:
gh secret set NPM_TOKEN -b $NPM_TOKEN

# verify secrets are set correctly
gh secret list

# re-create git repository
git init

# attach local repository to remote
git remote add origin "https://github.com/$(git config user.name)/$PROJECT.git"

# add, commit and push for the first time
git add .
git commit -m "Initial commit"
git branch -M main
```

As the release tool will use default secrets.GITHUB_TOKEN to create the release. It's a default value, which is generated by GitHub. You don't need to set it manually. But you need to goto [GitHub Settings](https://github.com/robinmin/npm-package-starter/settings/actions) to grant permissions. Under Settings > Actions > General > Workflow permissions:
  - Choose: Read and write permissions.
  - Enable: Allow GitHub Actions to create and approve pull requests.

Once all of these are done, you can push to the remote repository and trigger a workflow of release:
```bash
git push -u origin
```

Under Pull Requests, open the new "Version Packages" PR and click Rebase and Merge.


## Verification
Use the following commands to test the setup of the project is ready for use or not. Before you start, make sure you have Filled `description` in `package.json`.

```bash
# Install development dependencies
pnpm i
pnpm approve-builds

# Write sources under `src`, build
pnpm build

# Write tests under `src` and `tests` as `*.test.ts`, run with:
pnpm test

# Prepare package documentation
pnpm docs
```

## Reference
- [npm-package-starter](https://github.com/IlyaSemenov/npm-package-starter)
- [Create your first NPM Package â€” 2025 Edition](https://medium.com/@ukpai/create-your-first-npm-package-2025-edition-217b44a87671)
